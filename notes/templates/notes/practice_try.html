{% extends 'notes/practice.html' %}
{% load static %}

{% block bodyclass %}
  bg-light
{% endblock %}

{% block timeup %}
  <div class='card z-3 shadow  text-bg-primary' id="time-up" style="display: none;">
    <div class='card-body'>
      <button type='button' class='btn-close position-absolute top-0 end-0 m-2' aria-label='Close'
              onclick='document.getElementById("time-up").remove()'></button>
      <p><strong>Timeâ€™s up!</strong></p>
      <p>To continue practicing, close this popup.</p>
      <p>Want to save your progress without signing up? Click here to save to cache and take you to a page you
        can bookmark. There you can practice whenever you want.</p>
      <p>To save your progress through this app, and get access to a whole host of features such as progress
        reports, reminders, etc, click here to sign up. Unless costs mount, this app will remain free.</p>
      <p>
        {% include 'phrase.html' %}.
      </p>
    </div>
  </div>
{% endblock timeup %}

{% block cardheader %}

  <div class="dropdown">
    <button
      class="btn btn-light btn-xs p-0 dropdown-toggle"
      type="button"
      id="dropdownMenuCog"
      data-bs-toggle="dropdown"
      aria-expanded="false">
      <i class="fa-solid fa-music"></i> {{ instrument }},
      {{ level }}{% if key != transpose_key %}, transposing to {{ transpose_key }}{% endif %}
    </button>

    <ul class="dropdown-menu" aria-labelledby="dropdownMenuCog">
      <!-- Instrument Section -->
      <li><h6 class="dropdown-header">Instrument</h6></li>
      {% for my_instrument in instruments %}
        <li>
          <a class="dropdown-item {% if my_instrument == instrument %}active{% endif %}"
             href="{% url 'practice-try' instrument=my_instrument clef=clef key=key level=level %}">
            {{ my_instrument }}
          </a>
        </li>
      {% endfor %}

      <li>
        <hr class="dropdown-divider">
      </li> <!-- Divider -->

      <!-- Level Section -->
      <li><h6 class="dropdown-header">Level</h6></li>
      {% for my_level in levels %}
        <li>
          <a class="dropdown-item {% if my_level == level %}active{% endif %}"
             href="{% url 'practice-try' instrument=instrument clef=clef key=key level=my_level %}">
            {{ my_level }}
          </a>
        </li>
      {% endfor %}

      <li>
        <hr class="dropdown-divider">
      </li> <!-- Divider -->

      <!-- Clef Section -->
      <li><h6 class="dropdown-header">Clef</h6></li>
      {% for my_clef in clefs %}
        <li>
          <a class="dropdown-item {% if my_clef == clef %}active{% endif %}"
             href="{% url 'practice-try' instrument=instrument clef=my_clef key=key level=level %}">
            {{ my_clef }}
          </a>
        </li>
      {% endfor %}

      <li>
        <hr class="dropdown-divider">
      </li> <!-- Divider -->

      <!-- Key Section -->
      <li><h6 class="dropdown-header">Transpose to</h6></li>
      {% for my_key in keys %}
        <li>
          <a class="dropdown-item {% if my_key == transpose_key %}active{% endif %}"
             href="{% url 'practice-try' instrument=instrument clef=clef key=my_key level=level %}">
            Key: {{ my_key }}
          </a>
        </li>
      {% endfor %}
    </ul>
  </div>
  {% include 'notes/components/practice_dropdown_menu_right.html' %}
{% endblock cardheader %}

{% block see_results %}
  <a id="see-results" class="btn btn-link btn-xs text-start p-0 m-0">Stop and see your results
  </a>
  <script>
    document.getElementById('see-results').addEventListener('click', () => {

      fetch("{% url 'learningscenario_graph_try' instrument level %}", {
        method: 'POST', // HTTP method
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': "{{ csrf_token }}"
        },
        body: JSON.stringify(window.progress_data) // Convert the list to JSON format
      })
        .then(response => {
          if (response.redirected) {
            // If the backend sends a redirect, navigate to the returned location
            window.location.href = response.url;
          } else {
            return response.text(); // Get the response as text (full HTML in this case)
          }
        })
        .then(data => {
          if (data) {
            document.open();
            document.write(data);
            document.close();
          }
        })
        .catch(error => {
          console.error("Error:", error);
        });
    })
  </script>

{% endblock see_results %}




{% block navbar %}{% endblock navbar %}
{% block messages %}{% endblock messages %}
