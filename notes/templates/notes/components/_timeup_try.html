{% extends 'notes/components/_timeup.html' %}

{% block extra %}
  <h5 class="card-title">
    <i class="fa-regular fa-clock me-2"></i>To continue practising, close this popup. Or...
  </h5>

  <div class="d-flex flex-column gap-4">

    <div class="option-block">
      <!-- Loading indicator -->
      {% with link_css="fw-bold link-light link-underline-opacity-50 link-underline-opacity-100-hover" %}
        <ul class="list mb-0">
          <li class="mb-2">
            Refresh this page to try and beat your record!
          </li>
          <script>
            document.addEventListener('DOMContentLoaded', function () {

              var inIframe = window.self !== window.top;
              if (inIframe) {
                var el = document.getElementById('practice-reminder');
                el.style.display = '';
              }
            });
          </script>

          <li id="practice-reminder" class="mb-2" style="display:none;">
            You can practice whenever you want, where you left of, by visiting
            <a class="{{ link_css }}"
               target="_blank"
               href="{{ request.build_absolute_uri }}">this page</a>. Here, practice data is anonymously stored in your
            browser cache.
          </li>
          <li class="mb-2" id="install-prompt-li">
            Want to keep your progress and practice daily?
            <button type="button" id="install-pwa-btn-timeup" class="btn btn-success btn-sm">
              <i class="fa-solid fa-download me-1"></i> Install
            </button>
            this app on your phone and use apps like HabitNow in the
            <a href="https://apps.apple.com/app/habitnow" target="_blank" rel="noopener noreferrer" class="text-white">
              <i class="fa-brands fa-app-store me-1"></i>App Store</a> and
            <a href="https://play.google.com/store/apps/details?id=com.habitnow" target="_blank"
               rel="noopener noreferrer" class="ms-2 text-white"><i class="fa-brands fa-google-play me-1"></i>Google
              Play</a> to help to remember to practice.
          </li>
        </ul>
        <script>
          document.addEventListener("DOMContentLoaded", function () {
            // Hide install prompt if running as PWA
            const isPWA = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true;
            if (isPWA) {
              const installLi = document.getElementById("install-prompt-li");
              if (installLi) installLi.style.display = "none";
            }

            const proxy = document.getElementById("install-pwa-btn-timeup");
            if (!proxy) return
            const original = document.getElementById("install-pwa-btn");
            if (!original) {
              // Hide the proxy button if the install button is not available in this context
              proxy.style.display = "none";
              return;
            }
            proxy.addEventListener("click", function (e) {
              e.preventDefault();
              original.click();
            });
          });
        </script>

      {% endwith link_css %}
    </div>
  </div>
{% endblock extra %}
