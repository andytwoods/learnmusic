{% extends "base.html" %}
{% load static %}

{% block css %}
  {{ block.super }}
  <style>
    #instrumentLevelButton {
      transition: background-color 0.3s, color 0.3s, opacity 0.3s; /* Smooth transitions */
      opacity: 0.5; /* Slightly transparent while disabled */
    }

    #instrumentLevelButton:disabled {
      background-color: #6c757d !important; /* Keep it gray while disabled */
      color: white !important; /* Text remains white for consistency */
      opacity: 0.5; /* Disabled button appears semi-transparent */
      cursor: not-allowed; /* Show disabled cursor */
    }

    #instrumentLevelButton:not(:disabled) {
      opacity: 1; /* Fully visible when enabled */
    }
  </style>
{% endblock css %}

{% block body %}

  {% include 'navbar.html' %}

  {% include 'messages.html' %}

  <!-- Hero Section -->
  <section class="custom-lander text-white text-center py-5">
    <div class="overlay"></div>
    <div class="container relative z-10">
      <h1 class="text-4xl font-bold mb-2">Master Your Notes, Master the Stage</h1>
      <p class="text-xl mb-4">A practice tool for musicians <b>at any stage</b> to improve their note recognition and playing
        skills—quickly and effectively.</p>
      <a href="#" class="btn btn-primary" style="text-shadow: none !important;">Get Started</a>
    </div>
  </section>

  <section class="pt-5">
    <div class="container mx-auto px-4">
      <h2 class="text-2xl font-bold mb-4">Have a go now!</h2>
      {{ instruments|json_script:"instruments-data" }}
      <script>
        document.addEventListener("DOMContentLoaded", function () {
          const instruments = JSON.parse(
            document.getElementById('instruments-data').textContent
          );

          // Get references to the dropdown elements
          const instrumentDropdownMenu = document.getElementById('instrumentDropdownMenu');
          const instrumentButton = document.getElementById('instrumentButton');
          const instrumentLevelDropdownMenu = document.getElementById('instrumentLevelDropdownMenu');
          const instrumentLevelButton = document.getElementById('instrumentLevelButton');

          // Populate the instrument-dropdown with keys of the instruments object
          for (const instrument in instruments) {
            const item = document.createElement('li');
            const link = document.createElement('a');
            link.className = 'block px-4 py-2 hover:bg-gray-100';
            link.href = '#';
            link.textContent = instrument;
            link.addEventListener('click', function (e) {
              e.preventDefault();
              // Update the main dropdown button text and populate the levels dropdown
              instrumentButton.textContent = instrument;

              // Enable and Populate the level dropdown
              populateInstrumentLevels(instrument, instruments[instrument]);

              // Enable the level dropdown
              instrumentLevelButton.disabled = false;
            });
            item.appendChild(link);
            instrumentDropdownMenu.appendChild(item);
          }

          // Function to populate the instrument-level dropdown
          function populateInstrumentLevels(instrument, info) {

            // Clear existing levels
            instrumentLevelDropdownMenu.innerHTML = '';

            // Add levels to the dropdown
            info['levels'].forEach(level => {
              const item = document.createElement('li');
              const link = document.createElement('a');
              link.className = 'block px-4 py-2 hover:bg-gray-100';
              link.href = '#';
              link.textContent = level;
              link.addEventListener('click', function (e) {
                e.preventDefault();
                instrumentLevelButton.textContent = level;
                const url = "{{ request.scheme }}://{{ request.get_host }}/{{ practice_url }}/" + instrument + "/treble/Bb/" + level + "/";
                loadIframe(url);
              });
              item.appendChild(link);
              instrumentLevelDropdownMenu.appendChild(item);
            });
          }
        });

        function loadIframe(src) {
          // Get the container where the iframe will be added
          const container = document.getElementById("iframe-container");

          // Clear any existing content in the container (optional)
          container.innerHTML = "";

          // Create the iframe element
          const iframe = document.createElement("iframe");

          // Set iframe attributes
          iframe.src = src;
          iframe.style.width = "100%"; // Take the full width of the parent
          iframe.style.height = "100%"; // Take the full height of the parent
          iframe.style.border = "none"; // Remove the border for a clean look
          iframe.onload = function () {
            try {
              const iframeContent = iframe.contentWindow.document.body;
              iframe.style.height = iframeContent.scrollHeight + 120 + "px"; // Adjust the height based on content
            } catch (err) {
              console.error("Unable to adjust iframe height due to cross-origin restrictions:", err);
            }
          };
          // Append the iframe within the container
          container.appendChild(iframe);
        }
      </script>
      <div>
        <div class="flex flex-col md:flex-row items-start md:items-center gap-2">
          <!-- Instrument Dropdown -->
          <div class="dropdown">
            <div tabindex="0" role="button" class="btn btn-primary" id="instrumentButton">
              Select your instrument
            </div>
            <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52" id="instrumentDropdownMenu">
            </ul>
          </div>

          <!-- Instrument Level Dropdown -->
          <div class="dropdown">
            <div tabindex="0" role="button" class="btn btn-secondary" id="instrumentLevelButton" disabled>
              What level do you play at?
            </div>
            <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52" id="instrumentLevelDropdownMenu">
              <!-- Items will be dynamically populated -->
            </ul>
          </div>
        </div>
      </div>
    </div>
  </section>
  <div class="m-1">
    <div id="iframe-container" class="w-full">
      <!-- The iframe will be added here dynamically -->
    </div>
  </div>

  <!-- Features Section -->
  <section id="features" class="py-5">
    <div class="container mx-auto px-4">
      <div class="text-center mb-4">
        <h2 class="text-2xl font-bold">Why Choose Our App?</h2>
        <p class="text-gray-600">Everything you need to improve your skills as a musician.</p>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="card bg-base-100 shadow-xl">
          <div class="card-body text-center">
            <h2 class="card-title justify-center"><i class="bi bi-music-note"></i> Quick Note Practice</h2>
            <p>Engaging exercises to help you play notes faster and more accurately.</p>
          </div>
        </div>
        <div class="card bg-base-100 shadow-xl">
          <div class="card-body text-center">
            <h2 class="card-title justify-center"><i class="bi bi-bar-chart"></i> Track Your Progress</h2>
            <p>Get detailed insights and analytics on your improvement journey.</p>
          </div>
        </div>
        <div class="card bg-base-100 shadow-xl">
          <div class="card-body text-center">
            <h2 class="card-title justify-center"><i class="bi bi-question-circle"></i> Personalized Challenges</h2>
            <p>Tailored exercises that match your skill level and musical goals.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Testimonials Section -->
  <section id="testimonials" class="bg-base-200 py-5">
    <div class="container mx-auto px-4">
      <div class="text-center mb-4">
        <h2 class="text-2xl font-bold">What Users Say</h2>
        <p class="text-gray-600">Join thousands of musicians who've improved their skills!</p>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="bg-base-100 p-4 rounded-lg shadow">
          <blockquote>
            <p class="italic">"This app has transformed the way I practice trumpet notes."</p>
            <footer class="text-gray-600 mt-2">— Sara T., Trumpeter</footer>
          </blockquote>
        </div>
        <div class="bg-base-100 p-4 rounded-lg shadow">
          <blockquote>
            <p class="italic">"I've never been more confident playing the piano. Thank you!"</p>
            <footer class="text-gray-600 mt-2">— John D., Pianist</footer>
          </blockquote>
        </div>
        <div class="bg-base-100 p-4 rounded-lg shadow">
          <blockquote>
            <p class="italic">"Perfect for beginners and experienced musicians alike."</p>
            <footer class="text-gray-600 mt-2">— Anna K., Violinist</footer>
          </blockquote>
        </div>
      </div>
    </div>
  </section>

  <footer class="bg-neutral text-neutral-content py-4">
    <div class="container mx-auto px-4">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <!-- About Section -->
        <div>
          <h5 class="text-lg font-bold mb-2">About Us</h5>
          <p>We create tools to help musicians practice effectively and grow to their full potential.</p>
        </div>
        <!-- Links Section can be added here if needed -->
      </div>

      <div class="text-center mt-3">
        <p class="mb-0">&copy; {% now "Y" %} LearnMusic. All Rights Reserved.</p>
      </div>
    </div>
  </footer>
{% endblock body %}
