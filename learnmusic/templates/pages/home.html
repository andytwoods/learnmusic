{% extends "base.html" %}
{% load static %}

{% block css %}
  {{ block.super }}
  <style>
    #instrumentLevelButton {
      transition: background-color 0.3s, color 0.3s, opacity 0.3s; /* Smooth transitions */
      opacity: 0.5; /* Slightly transparent while disabled */
    }

    #instrumentLevelButton:disabled {
      background-color: #6c757d !important; /* Keep it gray while disabled */
      color: white !important; /* Text remains white for consistency */
      opacity: 0.5; /* Disabled button appears semi-transparent */
      cursor: not-allowed; /* Show disabled cursor */
    }

    #instrumentLevelButton:not(:disabled) {
      opacity: 1; /* Fully visible when enabled */
    }

    .tab-content {
      position: relative;
      overflow: hidden;
      height: 200px;
    }

    .tab-pane {
      position: absolute;
      width: 100%;
      top: 0;
      left: 0;
      transition: transform 0.5s ease, opacity 0.5s ease;
      opacity: 0;
      transform: translateX(100%);
      z-index: 0;
    }

    .tab-pane.slide-in-left {
      transform: translateX(0);
      opacity: 1;
      z-index: 1;
    }

    .tab-pane.slide-out-left {
      transform: translateX(-100%);
      opacity: 0;
      z-index: 0;
    }

    .tab-pane.slide-in-right {
      transform: translateX(0);
      opacity: 1;
      z-index: 1;
    }

    .tab-pane.slide-out-right {
      transform: translateX(100%);
      opacity: 0;
      z-index: 0;
    }

    /* Features section polish */
    #features {
      background: rgba(13, 110, 253, 0.08);
      border-top: 1px solid rgba(0, 0, 0, 0.05);
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }

    #features .feature-card {
      transition: transform 200ms ease, box-shadow 200ms ease;
      border-radius: 0.75rem;
    }

    #features .feature-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 0.75rem 1.5rem rgba(0, 0, 0, 0.1);
    }

    /* Controls */
    #featuresCarousel .carousel-control-prev,
    #featuresCarousel .carousel-control-next {
      width: 3rem;
    }

    #featuresCarousel .carousel-control-prev .control-pill,
    #featuresCarousel .carousel-control-next .control-pill {
      background: #0d6efd;
      color: #fff;
      width: 2.5rem;
      height: 2.5rem;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0.5rem 1rem rgba(13, 110, 253, 0.25);
      transition: transform 150ms ease, background-color 150ms ease;
    }

    #featuresCarousel .carousel-control-prev:hover .control-pill,
    #featuresCarousel .carousel-control-next:hover .control-pill {
      transform: scale(1.05);
      background: #0b5ed7;
    }

    /* Indicators */
    #featuresCarousel .carousel-indicators [data-bs-target] {
      width: .75rem;
      height: .75rem;
      border-radius: 50%;
      background-color: rgba(13, 110, 253, .35);
    }

    #featuresCarousel .carousel-indicators .active {
      background-color: #0d6efd;
    }

    /* Faster slide transition feel */
    #featuresCarousel {
      --bs-carousel-transition-duration: .35s;
    }

    .carousel-indicators {
      position: relative !important;
    }
  </style>
{% endblock css %}

{% block body %}

  {% include 'navbar.html' %}

  {% include 'messages.html' %}

  <!-- Hero Section -->
  <section class="custom-lander text-white text-center py-5">
    <div class="overlay"></div>
    <div class="container position-relative">
      <h1 class="display-4">Master Your Notes, Master the Stage</h1>
      <p class="lead">A practice tool for musicians <b>at any stage</b> to improve their note recognition and playing
        skills—quickly and effectively.</p>
      <button type="button" class="btn btn-light btn-lg" data-bs-toggle="modal" data-bs-target="#practiceModal" style="text-shadow: none !important;">Get Started</button>
      <div class="pt-3" style="z-index: 10;">
        {% include 'phrase.html' %}
      </div>
      <div>This is an opensource app

        <a class="text-white"
           href="https://github.com/andytwoods/learnmusic"
           target="_blank"
           data-bs-toggle="tooltip"
           data-bs-placement="bottom"
           title="MIT with Commons Clause License">
          <i class="fab fa-github me-2"></i>MIT-CC
        </a>
      </div>
    </div>


    <div class="container my-4">
      <div class="alert alert-info d-flex align-items-center p-4" role="alert" style="text-shadow: none;">
        <div class="flex-shrink-0 me-3">
          <i class="fas fa-check-circle fa-3x" style="text-shadow: none;"></i>
        </div>
        <div style="text-shadow: none;">
          <h4 class="alert-heading mb-1" style="text-shadow: none;">Free (as in beer). No Signup. No Ads. No tracking.</h4>
          <p class="mb-0">
            This app is completely free to use. You don't need to create an account, and there are no advertisements. Nothing is tracked.
            Just start practicing!
          </p>
        </div>
      </div>
    </div>


  </section>

  <section class="py-5 alt-bg">
    <div class="overlay"></div>
    <div class="container position-relative">
      <h2 class="text-center mb-4">How It Works</h2>

      <div class="row justify-content-center mb-5">
        <div class="col-6 text-center">
          <img style="max-height:500px;" src="{% static 'images/phone.png' %}" class="img-fluid rounded shadow-sm" alt="How LearnMusic works">
        </div>
        <div class="col-6 d-flex flex-column justify-content-center text-start ps-lg-5">
          <h3 class="fw-bold mb-3">Train Your Muscle Memory</h3>
          <p class="lead text-muted mb-4">
            Just 30 random notes a day is all it takes.
          </p>
          <p>
            Regular, short practice sessions help you build a direct link between your eyes and your fingers.
            Stop translating notes in your head and start playing them by instinct.
          </p>
        </div>
      </div>

      <div class="row g-4">
        <div class="col-md-6 col-lg-3">
          <div class="card h-100 shadow-sm border-0 bg-light">
            <div class="card-body text-center">
              <div class="d-flex align-items-center justify-content-center mb-3">
                <i class="fas fa-calendar-check fa-2x text-primary me-3"></i>
                <h5 class="card-title mb-0">Daily exercises</h5>
              </div>
              <p class="card-text">Daily short exercises to strengthen the link between reading a note and playing it
                with the correct fingering.</p>
            </div>
          </div>
        </div>

        <div class="col-md-6 col-lg-3">
          <div class="card h-100 shadow-sm border-0 bg-light">
            <div class="card-body text-center">
              <div class="d-flex align-items-center justify-content-center mb-3">
                <i class="fas fa-chart-line fa-2x text-success me-3"></i>
                <h5 class="card-title mb-0">Progressive Learning</h5>
              </div>
              <p class="card-text">You'll start with common notes, then gradually move into new key signatures,
                accidentals, and more complex patterns.</p>
            </div>
          </div>
        </div>

        <div class="col-md-6 col-lg-3">
          <div class="card h-100 shadow-sm border-0 bg-light">
            <div class="card-body text-center">
              <div class="d-flex align-items-center justify-content-center mb-3">
                <i class="fas fa-trophy fa-2x text-warning me-3"></i>
                <h5 class="card-title mb-0">Advanced Challenges</h5>
              </div>
              <p class="card-text">Prefer a challenge? You can also practise transposing and other advanced skills to
                take your musicianship to the next level.</p>
            </div>
          </div>
        </div>

        <div class="col-md-6 col-lg-3">
          <div class="card h-100 shadow-sm border-0 bg-light">
            <div class="card-body text-center">
              <div class="d-flex align-items-center justify-content-center mb-3">
                <i class="fas fa-dumbbell fa-2x text-info me-3"></i>
                <h5 class="card-title mb-0">Muscle memory</h5>
              </div>
              <p class="card-text">Customise your user interface so it matches how you play your instrument. Your
                practice fine tunes muscle memory.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="py-5 bg-light">
    <div class="container">
      <div class="text-center mb-5">
        <h2 class="mb-4">Ready to Practice?</h2>
        <button type="button" class="btn btn-primary btn-lg px-5 py-3 fs-4 shadow-sm" data-bs-toggle="modal" data-bs-target="#practiceModal">
          <i class="fas fa-play me-2"></i> Start Practicing Now
        </button>

        <div class="mt-4">
          <small class="text-muted">
            <p class="mb-2">
              <i class="fas fa-mobile-alt me-1"></i> <strong>Tip:</strong> Install as a PWA (Add to Home Screen) to practice offline!
            </p>
            <p class="mb-0">
              <i class="fas fa-sliders-h me-1"></i> <strong>Tip:</strong> Once in, use the menu to adapt the challenge (keys, notes, etc).
            </p>
          </small>
        </div>
      </div>
    </div>
  </section>


  <!-- Testimonials Section -->
  <section id="testimonials" class="py-5 alt-bg">
    <div class="container">
      <div class="text-center mb-4">
        <h2>What Users Say</h2>
        <p class="text-muted">Join thousands of musicians who’ve improved their skills!</p>
      </div>
      <div class="row">
        <div class="col-md-4">
          <blockquote class="blockquote">
            <p>"This app has transformed the way I practice trumpet notes"</p>
            <footer class="blockquote-footer">Sara T.</footer>
          </blockquote>
        </div>
        <div class="col-md-4">
          <blockquote class="blockquote">
            <p>"I’ve never been more confident playing the trombone. Thank you!"</p>
            <footer class="blockquote-footer">John D.</footer>
          </blockquote>
        </div>
        <div class="col-md-4">
          <blockquote class="blockquote">
            <p>"Perfect for beginners and experienced musicians alike"</p>
            <footer class="blockquote-footer">Anna K.</footer>
          </blockquote>
        </div>
      </div>
    </div>
  </section>

  <!-- SEO Content (Hidden or subtle) -->
  <section class="py-5">
    <div class="container">
      <div class="row">
        <div class="col-lg-8 mx-auto text-muted">
          <h3 class="h5">About Tootology</h3>
          <p>
            Tootology is a free online music practice tool designed to help musicians master note recognition and fingering.
            Whether you play trumpet, trombone, french horn, tuba, euphonium, or other brass and wind instruments,
            our progressive exercises help build muscle memory and sight-reading speed.
          </p>
          <p>
            Practice scales, intervals, and random notes in various key signatures and clefs (Treble, Bass, Alto, Tenor).
            No signup required, no ads, and works offline as a Progressive Web App (PWA).
          </p>
          <hr class="my-4">
          <h4 class="h6">Privacy &amp; Origin Story</h4>
          <p class="small">
            This app was originally created to help my 12-year-old son, who has dyslexia, learn his trumpet notes when he was struggling.
            It is now shared entirely for the community. We store <strong>no personal information</strong> and use <strong>no tracking cookies</strong>.
            Your practice is private and safe.
          </p>
        </div>
      </div>
    </div>
  </section>

  {% include 'footer.html' %}

{% endblock body %}

{% block modal %}
  <!-- Modal -->
  <div class="modal fade" id="practiceModal" tabindex="-1" aria-labelledby="practiceModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="practiceModalLabel">Start Practicing</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div id="step1">
            <h6 class="mb-3">Select your instrument:</h6>
            <div class="d-grid gap-2">
              {% for instrument, data in instruments.items %}
                <button class="btn btn-outline-primary instrument-btn text-capitalize"
                        data-instrument="{{ instrument }}"
                        data-clef="{{ data.clefs.0 }}"
                        data-key="{{ data.keys.0 }}">
                  {{ instrument }}
                </button>
              {% endfor %}
            </div>

            <div class="mt-4 pt-3 border-top text-center">
               <p class="small text-muted mb-2">
                 Don't see your instrument? Contributions to this open-source project are welcome!
               </p>
               <a class="text-muted text-decoration-none"
                   href="https://github.com/andytwoods/learnmusic"
                   target="_blank"
                   data-bs-toggle="tooltip"
                   data-bs-placement="bottom"
                   title="MIT with Commons Clause License">
                  <i class="fab fa-github me-2"></i>MIT-CC
                </a>
            </div>
          </div>
          <div id="step2" class="d-none">
            <h6 class="mb-3">Select your level:</h6>
            <div class="d-grid gap-2" id="levelButtons">
              <!-- Levels will be populated by JS -->
            </div>
            <div class="mt-3 text-muted small">
                <p class="mb-0">
                    This determines the notes you start to practice with. You can edit this, and many other settings, once you start practicing.
                </p>
            </div>
            <button class="btn btn-link mt-3" id="backToStep1">Back</button>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock modal %}

{% block inline_javascript %}
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const instrumentsData = {{ instruments|safe }}; // Assuming instruments is passed as JSON-serializable dict
      // If instruments is not JSON serializable directly in template, we might need to construct a JS object manually or use a filter.
      // However, usually in Django templates, we can't just dump a dict to JS without a filter or tag if it's complex.
      // Let's assume we can reconstruct the data we need from the DOM or just use the data attributes we put on buttons.
      // Actually, for step 2 we need to know the levels for the selected instrument.
      // Let's serialize the instruments data to JSON in the view or construct a JS object here.
      // Since I cannot change the view right now easily without seeing it, I will try to build the JS object from the template loop.

      const instrumentsConfig = {};
      {% for instrument, data in instruments.items %}
        instrumentsConfig["{{ instrument }}"] = {
          levels: {{ data.levels|safe }},
          clef: "{{ data.clefs.0 }}",
          key: "{{ data.keys.0 }}"
        };
      {% endfor %}

      let selectedInstrument = null;
      let selectedClef = null;
      let selectedKey = null;

      const step1 = document.getElementById('step1');
      const step2 = document.getElementById('step2');
      const levelButtonsContainer = document.getElementById('levelButtons');
      const backToStep1 = document.getElementById('backToStep1');

      document.querySelectorAll('.instrument-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          selectedInstrument = this.dataset.instrument;
          selectedClef = this.dataset.clef;
          selectedKey = this.dataset.key;

          // Populate levels
          levelButtonsContainer.innerHTML = '';
          const instruments = instrumentsConfig[selectedInstrument];
          if (instruments && instruments.levels) {
              instruments.levels.forEach(level => {
                const levelBtn = document.createElement('button');
                levelBtn.className = 'btn btn-outline-secondary level-btn';
                levelBtn.textContent = 'Level ' + level;
                levelBtn.addEventListener('click', function() {
                  // Redirect to practice URL
                  // URL pattern: /practice-try/<instrument>/<clef>/<key>/<level>/0/0/
                  const url = `/practice-try/${selectedInstrument}/${selectedClef}/${selectedKey}/${level}/0/0/`;
                  window.location.href = url;
                });
                levelButtonsContainer.appendChild(levelBtn);
              });
          }

          step1.classList.add('d-none');
          step2.classList.remove('d-none');
        });
      });

      backToStep1.addEventListener('click', function() {
        step2.classList.add('d-none');
        step1.classList.remove('d-none');
      });
    });
  </script>
{% endblock inline_javascript %}
